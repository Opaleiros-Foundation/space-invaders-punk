# This file is automatically generated by Gemini.
# It defines a GitLab CI/CD pipeline to build a PDF from your Writerside project.

variables:
  INSTANCE: 'Writerside/d'
  DOCKER_VERSION: '2025.04.8412'
  PDF: 'PDF.xml'

stages:
  - build_pdf
  - deploy

build_pdf:
  stage: build_pdf
  image: registry.jetbrains.team/p/writerside/builder/writerside-builder:$DOCKER_VERSION
  script:
    - set -e
    - export DISPLAY=:99
    - Xvfb :99 &
    - PROJECT_ID=$(echo $INSTANCE | cut -d'/' -f2 | tr '[:lower:]' '[:upper:]')
    - PDF_FILE="pdfSource${PROJECT_ID}.pdf"
    - HTML_FILE="pdfSource${PROJECT_ID}.html"
    - /opt/builder/bin/idea.sh helpbuilderinspect -source-dir . -product $INSTANCE --runner gitlab -output-dir public -pdf $PDF
    - echo "Testing existence of $PDF_FILE and $HTML_FILE"
    - test -e public/$PDF_FILE
    - test -e public/$HTML_FILE
  artifacts:
    paths:
      - public/
    expire_in: 1 week

pages:
  stage: deploy
  script:
    - echo "Deploying to GitLab Pages..."
  artifacts:
    paths:
      - public
  only:
    - main
